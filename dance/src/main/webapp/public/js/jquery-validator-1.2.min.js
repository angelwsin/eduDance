/****************************************
 @Name：jQuery-Validator 基于jQuery的表单验证框架
 @Version: 1.2.0 beta
 @Author：Ready
 @Date：2015-02-25
 @Blog：http://www.365mini.com
 @Copyright：CodePlayer( Ready )
 @Email：CodePlayer360@gmail.com
*/
var V,v;!function(a){a&&!V&&(V=function(){},V.fn=V.prototype,V.pattern={},V.fn.pre={trim:function(b){return a.trim(b)},trimAll:function(a){return V.pattern.__whiteSpace||(V.pattern.__whiteSpace=/\s/g),a?a.replace(V.pattern.__whiteSpace,""):a},lower:function(a){return a?a.toLowerCase():a},upper:function(a){return a?a.toUpperCase():a},flush:function(a,b){return b&&b.val(a),a}},V.util={parseFormat:function(a){var b=a.indexOf("/"),c=[a,""];return b>0&&(c[0]=a.substring(0,b),c[1]=a.substr(b+1)),c},parseIntervalPattern:function(a){if(!V.pattern[a]){if(V.pattern.__interval||(V.pattern.__interval=/^([\[\(])(\d+(\.\d+)?)?(,)?(\d+(\.\d+)?)?([\]\)])$/),!V.pattern.__interval.test(a)||!RegExp.$2&&!RegExp.$4)throw"Unexpected pattern:"+a;var b={min:RegExp.$2,max:RegExp.$5};RegExp.$4==RegExp.$5?b.equals=!0:(b.left="["==RegExp.$1?">=":">",b.right="]"==RegExp.$7?"<=":"<"),V.pattern[a]=b}return V.pattern[a]},parseMessage:function(b,c,d){return b.replace(V.pattern.__message||(V.pattern.__message=/\{([^}]+)\}/g),function(b,e){var g,h,f=e.charAt(0);return"#"==f||"$"==f?(h=e.substr(1),g=c.domContext&&c.domContext[h]?d.getLabel(c.domContext[h]):d.getLabel(a("#"==f?"#"+h:"[name='"+h+"']"))):g=c[e],g||(g=""),g})},pushDomContext:function(a,b,c){a.domContext||(a.domContext=[]),b||(b=c.prop("name")),a.domContext.push(c),b&&(a.domContext[b]=c)}},V.fn.formatter={number:function(a,b,c){var d,f,e,g,h;if(2==arguments.length&&(c=b,b=V.util.parseFormat(c.format)[1]),d=V.pattern[c.format],!d){switch(b||(b="+int"),e=b.charAt(0)){case"+":f="";break;case"-":f="-";break;case"?":f="-?";break;default:e="+",f="",b=e+b}switch(g=b.substr(1)){case"int":case"integer":d=new RegExp("^"+f+"\\d+$");break;case"money":d=new RegExp("^"+f+"\\d+(\\.\\d{1,2})?$");break;case"float":case"double":d=new RegExp("^"+f+"\\d+(\\.\\d+)?$");break;default:h=g.split(".",2),d="^"+f+"\\d"+h[0],h[1]&&(d+="\\.\\d"+h[1]),d=new RegExp(d+"$")}V.pattern[c.format]=d}return d.test(a)?parseFloat(a):!1},date:function(a,b,c){var e,d,f,g,h;if(2==arguments.length&&(c=b,b=V.util.parseFormat(c.format)[1]),b?"datetime"==b?b="yyyy-MM-dd HH:mm:ss":"time"==b&&(b="HH:mm:ss"):b="yyyy-MM-dd",!a||a.length!=b.length)return!1;if(d=V.pattern[c.format],!d){for(f=V.pattern.__date||(V.pattern.__date=new RegExp("yyyy|MM|dd|HH|mm|ss","g")),d={},f.lastIndex=0;e=f.exec(b);)d[e[0]]=[e.index,e.index+e[0].length];V.pattern[c.format]=d}g={};for(h in d)if(e=d[h],e=a.substring(e[0],e[1]),g[h]=parseInt(e,10),g[h]!=e)return!1;return g.MM&&g.MM--,new Date(g.yyyy,g.MM||0,g.dd||1,g.HH||0,g.mm||0,g.ss||0)},idcard:function(){}},V.fn.applyDefaultSetting=function(b,c){return b.extend&&(c=this.rules[b.extend]),a.extend({required:!0},c,b)},V.fn.validator={required:function(a,b){if(b.dom&&b.dom.length){var c=b.dom[0],d=c.nodeName;"INPUT"!=d&&"input"!=d||"checkbox"!=c.type&&"radio"!=c.type||(b.actual=a=b.dom.filter(":checked").length)}if(!a){if(b.required)return this.sendError("required","",a,null,b),!1;b._stop=!0}},format:function(a,b){var c=V.util.parseFormat(b.format),d="format",e=this.formatter[c[0]];return e?(a=e(a,c[1],b),a===!1?(this.sendError(d,b.format,a,c[1],b),!1):a):(this.sendError(d,"invalid",a,null,b),!1)},text:function(b,c){var d="text",e=a.type(c.text);switch(e){case"string":if(c.text!=b)return this.sendError(d,"==",b,c.text,c),!1;break;case"regexp":if(!c.text.test(b))return this.sendError(d,"regexp",b,c.text,c),!1;break;case"function":if(c.text.call(this,b,c)===!1)return this.sendError(d,"function",b,c.text,c),!1;break;default:throw"Unexpected text validator:"+c.text}},length:function(a,b){return this.validator.range.call(this,b.value.length,b,"length",b.length)},range:function(a,b,c,d){var e,f,g;if(arguments.length<=2&&(c="range",d=b.range),e=V.util.parseIntervalPattern(d),e.equals){if(a!=e.min)return this.sendError(c,"==",a,e.min,b),!1}else{if(e.min&&(f=a>e.min||">="==e.left&&e.min==a,!f))return this.sendError(c,e.left,a,e.min,b),f;if(e.max&&(g=a<e.max||"<="==e.right&&e.max==a,!g))return this.sendError(c,e.right,a,e.max,b),g}},equalsTo:function(b,c){var d=a("[name='"+c.equalsTo+"']"),e=d.val();return b!=e?(V.util.pushDomContext(c,c.equalsTo,d),this.sendError("equalsTo","",b,e,c),!1):void 0},compare:function(b,c){var f,d={},e=this,g=!0,h=c.compare.replace(V.pattern.__compare||(V.pattern.__compare=/\b(this|now)\b|([$#])([^\s=+*\/%&|-]+)/g),function(h,i,j,k){var m,n,o,p,l=i||k;return g&&("this"==l?null==d[l]&&(d[l]=b):"now"==l?null==d[l]&&(d[l]=new Date):(m="#"==j?"#"+l:"[name='"+l+"']",n=a(m),o=n.val(),null!=o&&(c.propagation&&(p=a.extend({},c),delete p.compare,e.validate(n,p)===!1&&(g=!1)),V.util.pushDomContext(c,l,n),g&&(c.format?(f=f||V.util.parseFormat(c.format),o=e.formatter[f[0]](o,f[1],c),o!==!1&&(d[l]=o)):d[l]=o)))),'this["'+l+'"]'});return g?(this.devMode&&console&&(console.log(h),console.log(d)),f=new Function("return ("+h+")").call(d),f===!1?(this.sendError("compare","pattern",b,c.compare,c),!1):void 0):!1},cellphone:function(a,b){return V.pattern.cellhone||(V.pattern.cellhone=/^1\d{10}$/),V.pattern.cellhone.test(a)?void 0:(this.sendError("cellphone","pattern",a,V.pattern.cellhone,b),!1)},email:function(a,b){return V.pattern.email||(V.pattern.email=/^[\w._-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/),V.pattern.email.test(a)?void 0:(this.sendError("email","pattern",a,V.pattern.email,b),!1)},file:function(a,b){var c=new RegExp("\\.("+b.file+")$","i");return c.test(a)?void 0:(this.sendError("file","pattern",a,b.file,b),!1)},remote:function(b,c){for(var g,h,d=c.remote,e=a.type(d),f={type:"post",async:!1,dataType:"json"};g="function"==e;)d=d.call(null,b,c),e=a.type(d);switch(e){case"string":f.url=d,!g&&c.dom&&(null==c.name&&(c.name=c.dom.prop("name")),f.data={},f.data[c.name]=b);break;case"object":a.extend(f,d);break;default:throw"Unexpected remote validator:"+c.remote}return h=null,f.success=function(a){h=a},a.ajax(f),h?(h.message&&(c.message=h.message,this.sendError("remote","",b,null,c)),h.callback&&window[h.callback].call(c.dom,h,b,c),"OK"==h.status):!1}},V.fn.rules={},V.define=function(b,c,d){var e,f,g;if("object"!=typeof b)"object"!=typeof c&&(f={},f[b]=c,c=f),d=this===V?V.prototype:this,c.extend&&(g=d.rules[c.extend],g&&(c=a.extend({},g,c)),delete c.extend),d.rules[b]=c;else for(e in b)this.define(e,b[e])},V.fn.define=function(a,b){V.define.call(this,a,b)},V.fn.execute=function(b,c,d,e){var f,g,h;return b instanceof a||(b=a(b)),b.length?(null==d&&(d=c,c=null),f=this,c?(b.on(c,function(a){var b="submit"==a.type,c=b?this:a.target,e=b?d:d[c.name];return e?f.execute(c,null,e,a):!1}),void 0):(g=0,h=0,b.each(function(){var i,b=a(this),c=this.nodeName;if("FORM"==c||"form"==c)for(i in d){if(g++,f.validate(b.find("[name='"+i+"']"),d[i],e)===!1)return!1;h++}else{if(g++,f.validate(b,d,e)===!1)return!1;h++}}),g==h)):!1},V.fn.validate=function(b,c,d){var e,f,g,h;if("string"==typeof c&&(c=this.rules[c],!c))return!1;if(e=this.applyDefaultSetting(c),c=a.extend({},e),b instanceof a&&(e.dom=b,b=b.val()),c.preFilter){if(c.preFilter.call(this,b,e)===!1)return!0;delete c.preFilter}if(e.value=b,d&&(e.event=d),c.pre){f=c.pre.split(",");for(g in f)b=this.pre[f[g]].call(this,b,e.dom);e.value=b,delete c.pre}if(null!=c.required){if(this.validator.required.call(this,b,e)===!1)return!1;if(e._stop)return!0;delete c.required}if(c.format){if(b=this.validator.format.call(this,b,e),b===!1)return!1;if(e._stop)return!0;delete c.format}for(g in c)if(h=this.validator[g]){if(h.call(this,b,e)===!1)return!1;if(e._stop)return!0}return!0},V.fn.sendError=function(b,c,d,e,f){var g,h;this.silence||(!f.name&&f.dom&&(f.name=f.dom.prop("name")),g=a.extend({validator:b,trigger:c,actual:d,expected:e,label:this.getLabel(f.dom)},f),h=this.getMessage(g),this.render(h,g))},V.fn.messages={required:"{label}不能为空!",equalsTo:"{label}必须与{#0}输入一致!","==":"{label}必须等于{expected}!",">=":"{label}必须大于或等于{expected}!",">":"{label}必须大于或等于{expected}!","<=":"{label}必须小于或等于{expected}!","<":"{label}必须小于{expected}!","length.==":"{label}的长度必须等于{expected}!","length.>=":"{label}的长度必须大于或等于{expected}!","length.>":"{label}的长度必须大于{expected}!","length.<=":"{label}的长度必须小于或等于{expected}!","length.<":"{label}的长度必须小于{expected}!","format.number":"{label}必须是有效的数字!","format.number/money":"{label}必须是整数或最多保留两位的小数!","format.number/double":"{label}必须是有效的整数或小数!","format.date":"{label}必须是有效的日期!",pattern:"{label}的格式不正确!",regexp:"{label}的格式不正确!","function":"{label}的格式不正确!",file:"{label}的文件格式不正确，必须为{expected}等格式!"},V.fn.getMessage=function(a){var b="object"==typeof a.message?a.message[a.validator+"."+a.trigger]||a.message[a.validator]||a.message[a.trigger]:a.message;return b||(b=this.messages[a.validator+"."+a.trigger]||this.messages[a.validator]||this.messages[a.trigger]),b?(this.devMode&&console&&console.log(a),b=V.util.parseMessage(b,a,this)):b=this.messages["default"]||"您输入的格式不正确!",b},V.fn.labels={},V.fn.setLabel=function(b,c){"object"==typeof b?a.extend(this.labels,b):this.labels[b]=c},V.fn.getLabel=function(a){if(a&&a.length){var b=a.prop("name"),c=b&&this.labels[b]||a.attr("label")||a.prev("label").text();if(c)return"*"==c.charAt(0)?c.substr(1):c}return""},V.fn.render=function(a,b){b.dom&&b.dom.tips&&b.dom.tips(a)||alert(a);var c=b.event;(!c||"focusout"!=c.type&&"blur"!=c.type)&&b.dom&&b.dom.first().focus()},v=new V,a.fn.extend({v:function(a,b){return v.execute(this,a,b)}}),v.define({username:{pre:"trimAll,lower,flush",text:/^[a-z][a-z0-9_]{5,15}$/i,message:"{label}必须是英文、数字和下划线组成的6~16位字符，并且必须以字母开头!"},password:{length:"[6,16]"},age:{format:"number",range:"[18,100]"},"int":{format:"number"},"+int":{format:"number",range:"(0,)"},money:{format:"number/money"},"+money":{format:"number/money",range:"(0,)"},phoneCode:{format:"number",length:"[6]"},imageCode:{length:"[4]"},required:{},cellphone:!0,email:!0,idcard:!0,file:"jpg|jpeg|gif|png|bmp"}))}(jQuery);