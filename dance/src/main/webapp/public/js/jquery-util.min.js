(function(){if(navigator.userAgent.indexOf("MSIE 6.")>0){location.href=root+"/ie6.jsp";}})();$.extend({browser:{msie:navigator.userAgent.indexOf("MSIE")>0}});if(document.all&&!window.setTimeout.isPolyfill){var __nativeST__=window.setTimeout;window.setTimeout=function(b,a){var c=Array.prototype.slice.call(arguments,2);return __nativeST__(b instanceof Function?function(){b.apply(null,c);}:b,a);};window.setTimeout.isPolyfill=true;}if(document.all&&!window.setInterval.isPolyfill){var __nativeSI__=window.setInterval;window.setInterval=function(b,a){var c=Array.prototype.slice.call(arguments,2);return __nativeSI__(b instanceof Function?function(){b.apply(null,c);}:b,a);};window.setInterval.isPolyfill=true;}function logError(a){alert(a);}jQuery.ajaxSetup({error:function(b,c,a){jQuery.loading(false);alert('发送请求到"'+this.url+'"时出错['+b.status+"]："+a);}});jQuery.extend({postJSON:function(a,b,c){if(jQuery.isFunction(b)){c=b;b=undefined;}return jQuery.ajax({url:a,type:"POST",data:b,success:c,dataType:"json"});},POST:function(c,d,b){var a;jQuery.ajax({url:c,data:d,type:"POST",async:false,dataType:b,success:function(e){a=e;}});return a;},ajaxMessage:function(b,d,e,a){if(arguments.length==3){if(typeof e=="boolean"){a=e;}}if(arguments.length>1&&arguments.length<4){var c=jQuery.type(d);if(c=="boolean"){a=d,d=null;}else{if(c=="function"){e=d,d=null;}}}jQuery.loading();jQuery.ajax({url:b,data:d,type:"POST",dataType:"json",success:function(f){jQuery.loading(false);if(a!==false){if(f.message){alert(f.message);}if(f.callback&&jQuery.isFunction(window[f.callback])){window[f.callback].call(f);}if(f.url){if(f.url=="refresh"){location.reload();}else{location.href=f.url;}}}if(e&&jQuery.isFunction(e)){e.call(null,f);}}});},alert:function(c,b,a){var d;if(b instanceof Function){a=b;b="default";}if(a instanceof Function){d=function(e){layer.close(e);a.call(null,e);};}jQuery.layer({title:"系统提示",dialog:{msg:c,type:jQuery.getIcon(b),yes:d},area:[c.length>10?"220px":"180px","auto"]});},confirm:function(a,c,b){return layer.confirm(a,c,b);},loading:function(c,a){if(c===false){jQuery.loading.index&&layer.close(jQuery.loading.index)&&(jQuery.loading.index=null);}else{var b=typeof c;if(b=="number"){a=c;c=null;}if(!c){c="正在处理，请稍后...";}jQuery.loading.index=layer.load(c,0);}},tips:function(c,a,b){if(b==null){b=5;}layer.tips(c,a,{guide:1,time:b});},getIcon:function(a){if(!jQuery.getIcon.icons){jQuery.getIcon.icons={"default":-1,warn:0,ok:1,forbidden:3,question:4,cry:8,smile:9,weixin:12};}return jQuery.getIcon.icons[a in jQuery.getIcon.icons?a:"default"];},close:function(a){layer.close(a||layer.index);}});jQuery.fn.extend({trim:function(a){var c=jQuery.trim(this.val());if(a&&this.length>0){var b=this.length>1?this.first():this;b.val(c);}return c;},value:function(){if(this.length){var c=this.prop("type");if(c){c=c.toLowerCase();var b=c=="radio";if(b||c=="checkbox"){var a=this.attr("name");if(a){var d=jQuery("[name='"+a+"']:checked").map(function(){return this.value;}).get();return b?d[0]:d;}}}return this.val();}},selectAll:function(a){if(a==="inverse"){this.prop("checked",function(b,c){return !c;});}else{this.prop("checked",a!==false);}return this;},tips:function(b,a){jQuery.tips(b,this,a);return this;}});function Table(c,a,b){if(!Table.fn){Table.fn=Table.prototype;Table.fn.init=function(f,d,e){this._caption=f||this._caption||"表格";this._titleSetting=d||this._titleSetting;if(typeof this._titleSetting!="string"||!this._titleSetting){this._notAuth=true;logError('创建表格对象时，必须传入标题设置参数，例如："name=姓名;age=年龄;sex=性别"');return false;}if(!e||typeof e!="object"){e={};}if(!Table.size){Table.size=0;Table._Name="Table";Table._Id="UI_Table";Table._checkbox="ui_checkbox";Table._Widget="UI_Widget";Table._PageId="UI_PageId";Table._Action="UI_Action";}if(isNaN(this.index)){this.index=Table.size++;Table[this.index]=this;}this._name=Table._Name+"["+this.index+"]";this._data=e.list||[];this._id=parseInt(e.current)||1;this._size=parseInt(e.size)||0;this._count=parseInt(e.total)||0;this._orderBy=e.orderBy||"";this._args=e.args||"";};}if(this.init(c,a,b)==false){return;}this.actionName="操作";this.tips="查询不到符合条件的记录!";this.hasRowNumber=true;this.ajaxMode=false;this.link=null;this._rowTemplate={};this._rowHidden=[];this._rowAction=[];this._action=[];this._sizeArray=[10,20,50,100];if(!Table.fn.actionButton){Table.fn.actionButton=function(f,e,d){d=d!==false;this._action.push({name:f,callback:e,isNeed:d});};Table.fn.rowTemplate=function(e,d){this._rowTemplate[e]=d;this._rowTemplate.__hasP__=true;};Table.fn.rowLink=function(f,d){var e={name:f,href:d};if(jQuery.isFunction(f)){e.isFunction=true;}this._rowAction.push(e);};Table.fn.rowButton=function(d,f){var e={name:d,callback:f};if(jQuery.isFunction(d)){e.isFunction=true;}this._rowAction.push(e);};Table.fn.rowHidden=function(){var e=arguments.length;for(var d=0;d<e;d++){this._rowHidden.push(arguments[d]);}};Table.fn.rowDecode=function(){var f=arguments.length;if(f<2){logError("rowDecode函数至少需要传入2个参数。");}else{var e=arguments;var d=e[0];this.rowTemplate(d,function(k){var j=k[d];var g=(f&1)==0?f-1:f;for(var h=1;h<g;h++){if(j==e[h++]){return e[h];}}return g==f?j:e[g];});}};Table.fn.pageSize=function(){var e=arguments.length;if(e>0){var d=arguments[0];if(e==1){if(this._size<=0||d<=0){this._size=d;}}else{this._sizeArray=arguments;if(this._size<=0){this._size=d;}}}};Table.fn.run=function(g,d){var f=this._rowAction[d].callback;var e=this._data[g];f.call(e,e,g);};Table.fn.RUN=function(d){var g=this._action[d];var f=this._data;var e=[];jQuery("input[name='"+Table._checkbox+this.index+"']:checked").each(function(){e.push(f[this.value]);});if(g.isNeed&&e.length==0){logError("没有选中任何数据!");return;}g.callback(e,e);};Table.fn.selectAll=function(d){jQuery("input[name='"+Table._checkbox+this.index+"']").prop("checked",d.checked);};Table.fn.getTableWidget=function(){var j="";var e=this._name;var m=this.index;var g=this._id;var n=this._size;if(n>0&&this._data.length>0){j+='<div id="'+Table._Widget+m+'" class="ui-table-widget">';var f=this.ajaxMode?null:this.getPageURL();if(f){f=f.url+(f.hasParam?"&":"?");}if(g>1){if(this.ajaxMode){j+='<a href="javascript:;" onclick="'+e+'.goPage(1);">首页</a>';j+='<a href="javascript:;" onclick="'+e+".goPage("+(g-1)+');">上一页</a>';}else{j+='<a href="'+f+"page.current=1&page.size="+n+'">首页</a>';j+='<a href="'+f+"page.current="+(g-1)+"&page.size="+n+'">上一页</a>';}}else{j+="<span>首页</span><span>上一页</span>";}var k=Math.ceil(this._count/n);var d='<span class="ui-space">;</span>';if(k>g){if(this.ajaxMode){j+='<a href="javascript:;"  onclick="'+e+".goPage("+(g+1)+');">下一页</a>';j+='<a href="javascript:;" onclick="'+e+".goPage("+k+');">尾页</a>';}else{j+='<a href="'+f+"page.current="+(g+1)+"&page.size="+n+'">下一页</a>';j+='<a href="'+f+"page.current="+k+"&page.size="+n+'">尾页</a>';}}else{j+="<span>下一页</span><span>尾页</span>";}j+='<input class="ui-button" type="button" value="跳转到" onclick="'+e+'.goPage()" />第<input class="ui-text" id="'+Table._PageId+this.index+'" type="text" />页'+d;j+='每页显示<select onchange="'+e+'.changeSize(this)">';var l=this._sizeArray;for(var h in l){if(l[h]==n){j+='<option value="'+l[h]+'" selected>'+l[h]+"</option>";}else{j+='<option value="'+l[h]+'">'+l[h]+"</option>";}}j+="</select>条"+d;j+="当前页/总页数：";j+=g+"/"+k+d;j+="总记录数："+this._count+d;j+="</div>";}return j;};Table.fn.selectCurrentRow=function(){var d="#"+Table._Id+this.index+" tr";var e="[name='"+Table._checkbox+this.index+"']";jQuery(document.body).on("click",d,function(){var f=jQuery(this).find(e);f.prop("checked",!f.prop("checked"));});};Table.fn.changeSize=function(d){this.goPage(1,d.value);};Table.fn.getPageURL=function(d){var e={},f=window.location.search;d=d||window.location.pathname;if(f){f=f.substr(1).replace(/(&|^)page\.(current|size)=\d*/g,"");}if(f){e.url=d+"?"+f;e.hasParam=true;}else{e.url=d;}return e;};Table.fn.ajaxLoad=function(e,f){this.ajaxMode=true;f=f||this.link||window.location.href;if(!this.link){this.link=f;}if(!e){e=this._selector;}else{if(!this._selector){this._selector=e;}}var d=null;jQuery.ajax({url:f,type:"post",async:false,dataType:"json",success:function(g){d=g;}});if(d){this.init(null,null,json);this.show(e);}};Table.fn.goPage=function(f,d){if(f==null){var i=jQuery.trim(jQuery("#"+Table._PageId+this.index).val());f=parseInt(i,10);if(!f){logError("跳转页数必须为数字!");return false;}var e=this._count/this._size;e=Math.ceil(e);if(f>e){f=e;}if(f<1){f=1;}}d=parseInt(d)||this._size;var h=this.getPageURL();var g=h.url+(h.hasParam?"&":"?")+"page.current="+f+"&page.size="+d;if(this.ajaxMode){this.ajaxLoad(null,g);}else{self.location.href=g;}return false;};Table.fn.show=function(h){if(!h){h=this._selector;}else{this._selector=h;}if(!(h instanceof jQuery)){h=jQuery(h);}if(h.length==0){logError("调用show()方法必须提供用于加载表格内容的有效jQuery选择器参数！");return;}var g=this._titleSetting.split(/=|;/),J=this._action,U=this._rowAction;var u=g.length,n=U.length,S=J.length>0;if(u==0||(u&1)==1){logError('表格对象传入的标题设置参数格式不正确，应该采用如下格式："name=姓名;age=年龄;sex=性别"');return;}var r=[];for(var R=0;R<u;R++){r.push({name:g[R],title:g[++R]});}u=r.length;var G=u+n,L=this.hasRowNumber;var F=S||L;if(F){G++;}var K='<table id="'+Table._Id+this.index+'" class="ui-table">';K+="<caption>"+this._caption+"</caption>";K+='<tr class="tr-head">';var E=this._name;if(S){K+='<th class="th-first"><input type="checkbox" value="0" onclick="'+E+'.selectAll(this)" />全选</th>';}else{if(L){K+='<th class="th-first">序号</th>';}}for(var R=0;R<u;R++){K+='<th class="th-'+r[R].name+'">'+r[R].title+"</th>";}if(n>0){K+='<th class="th-action" colspan="'+n+'">'+this.actionName+"</th>";}K+="</tr>";var m=this._data;var y=jQuery.isArray(m);if(!y){var H=typeof(m);if(H=="object"){m=this._data=[m];y=true;}else{if(H=="string"){this.tips=m;}}}if(y&&m.length>0){var q=m.length,D=false,M=Table._checkbox+this.index;for(var R=0;R<q;R++){K+='<tr class="'+((D=!D)?"odd":"even")+'">';if(F){K+='<td class="td-first">';}if(this.hasRowNumber){K+='<span class="td-sequence">'+(R+1)+"</span>";}if(S){K+='<input name="'+M+'" type="checkbox" value="'+R+'" />';}if(F){K+="</td>";}var f=m[R];var d=p=this._rowTemplate;var o="__hasP__" in d;for(var Q=0;Q<u;Q++){var t=r[Q].name;var A=null;var N="";if(o){var p=d[t];if(jQuery.isFunction(p)){A=p.call(f,f);if(A==null){A="&nbsp;";}else{if(jQuery.isArray(A)){if(A[1]){N=" "+A[1]+" ";}}}}}if(A==null){A=f[t];if(A==null){A="&nbsp;";}}if(Q==0){var z=this._rowHidden;var v=z.length;if(v>0){for(var P=0;P<v;P++){var C=z[P];var s=f[C];A+='<input name="hidden_'+C+'" type="hidden" value="'+s+'" />';}}}if(N==""){N=' class="td-'+t+'" ';}K+="<td"+N+">"+A+"</td>";}if(n>0){for(var O=0;O<n;O++){var e=U[O];var B=e.isFunction?e.name.call(f,f):e.name;if(e.href){var w=e.href.call(f,f);if(w!=null){K+='<td class="td-action"><a href="'+w+'">'+B+"</a></td>";}else{K+='<td class="td-action">-</td>';}}else{if(e.callback){K+='<td class="td-action"><input class="ui-button" type="button" value="'+B+'" onclick="'+E+".run("+R+","+O+')" /></td>';}}}}K+="</tr>";}}else{K+='<tr><td colspan="'+G+'">'+this.tips+"</td></tr>";}K+="</table>";K+=this.getTableWidget();if(S){var T='<div id="'+Table._Action+this.index+'" class="ui-table-action">';for(var I in J){var e=J[I];T+='<input class="ui-button" type="button" value="'+e.name+'" onclick="'+E+".RUN("+I+')" />';}T+="</div>";K+=T;}jQuery(h).html(K);if(M&&this.rowSelected){this.selectCurrentRow();}};}}$(function(){if(window.WdatePicker){$("body").on("focusin",".date,.datetime",function(){var c=$(this);var b=c.data("dateCache");if(b==null){b={};var a=" "+this.className+" ";if(a.indexOf(" datetime ")!=-1){b.dateFmt="yyyy-MM-dd HH:mm:ss";}if(a.indexOf(" min-now ")!=-1){b.minDate="%y-%M-%d %H:%m:%s";}if(a.indexOf(" max-now ")!=-1){b.maxDate="%y-%M-%d %H:%m:%s";}else{if(a.indexOf(" max-now-1 ")!=-1){b.maxDate="%y-%M-#{%d-1} %H:%m:%s";}}c.data("dateCache",b);}WdatePicker(b);});}$("body").on("click",".waiting",function(){$.alert("即将开启，敬请期待！");return false;});});function goPage(b,a){var d={},e=window.location.search;var c=window.location.pathname;if(b!=1){b=parseInt($("#UI_PageId").trim(),10);}if(!b){logError("跳转页数必须为数字!");return false;}if(b<1){b=1;}if(e){e=e.substr(1).replace(/(&|^)page\.(current|size)=\d*/g,"");}if(e){c=c+"?"+e;}a=parseInt(a,10)||10;c=c+(e?"&":"?")+"page.current="+b+"&page.size="+a;location.href=c;}function changePageSize(a){goPage(1,a.value);}function Timer(a){if(!(this instanceof Timer)){return new Timer(a);}if(!Timer.initialized){Timer.prototype.start=function(){this.active=false;if(!this.initialized){this.dom=$("#"+this.opt.id);this.initTime=this.opt.time||this.dom.attr("time")||new Date();this.date=this.initTime instanceof Date?this.initTime:new Date(parseInt(this.initTime,10));this.initialized=true;}if(this.dom&&this.dom.length&&this.date){this.timerID=setInterval(this.handler,this.interval,this);}};Timer.prototype.handler=function(d){d.date.setTime(d.date.getTime()+d.step);if(d.date.getTime()<0){d.stop();}if(!d.pattern){var e={yyyy:"FullYear",MM:"Month",dd:"Date",HH:"Hours",mm:"Minutes",ss:"Seconds",SSS:"Milliseconds"},c=d.opt.render||e;d.pattern={};for(var b in c){if(e[b]){d.pattern[b]=(d.step>0?"get":"getUTC")+e[b];}}}var f={};for(var b in d.pattern){f[b]=d.date[d.pattern[b]]();if(b=="MM"){f[b]++;}if(d.zeroFill&&f[b]<10){f[b]="0"+f[b];}}if(d.renderCallback){d.renderCallback.call(d,f);}else{if(d.opt.render){if(!d.doms){d.doms={};}for(var b in d.opt.render){if(f[b]!=null){d.doms[b]=d.doms[b]||$("#"+d.opt.render[b]);d.doms[b].html(f[b]);}}}else{d.dom.html(f.yyyy+"-"+f.MM+"-"+f.dd+" "+f.HH+":"+f.mm+":"+f.ss);}}};Timer.prototype.stop=function(){clearInterval(this.timerID);};Timer.initialized=true;}this.opt=typeof a=="object"?a:{id:a};this.interval=this.opt.interval||1000;this.step=this.opt.step||1000;this.zeroFill=this.opt.zeroFill!==false;if(this.opt.renderCallback&&$.isFunction(this.opt.renderCallback)){this.renderCallback=this.opt.renderCallback;}}